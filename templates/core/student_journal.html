{% extends 'core/base.html' %}
{% block title %}–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫{% endblock %}
{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>üìä –ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫</h2>
        <a href="/" class="btn btn-secondary">‚Üê –ö –ø—Ä–µ–¥–º–µ—Ç–∞–º</a>
    </div>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% else %}
        {% if subjects_data %}
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover" style="font-size: 0.95rem;">
                    <thead class="table-dark sticky-top" style="top: 0;">
                        <tr>
                            <th style="width: 15%;">üìö –ü—Ä–µ–¥–º–µ—Ç</th>
                            <th style="width: 15%;">–ú–æ–¥—É–ª—å</th>
                            <th style="width: 20%;">–¢–µ—Å—Ç</th>
                            <th style="width: 10%; text-align: center;">–ë–∞–ª–ª—ã</th>
                            <th style="width: 10%; text-align: center;">%</th>
                            <th style="width: 15%;">–°—Ç–∞—Ç—É—Å</th>
                            <th style="width: 15%;">–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for data in subjects_data %}
                            {% for attempt in data.attempts %}
                                <tr>
                                    {% if forloop.first %}
                                        <td rowspan="{{ data.count }}" style="vertical-align: middle; font-weight: bold; background-color: #f8f9fa;">
                                            {{ data.subject.name }}
                                        </td>
                                    {% endif %}
                                    <td>{{ attempt.test.module.name }}</td>
                                    <td>{{ attempt.test.name }}</td>
                                    <td style="text-align: center;">
                                        <span class="badge bg-info">{{ attempt.score|floatformat:0 }}</span>
                                    </td>
                                    <td style="text-align: center;">
                                        <strong>
                                            {% if attempt.score >= 70 %}
                                                <span class="text-success">{{ attempt.score|floatformat:0 }}%</span>
                                            {% elif attempt.score >= 50 %}
                                                <span class="text-warning">{{ attempt.score|floatformat:0 }}%</span>
                                            {% else %}
                                                <span class="text-danger">{{ attempt.score|floatformat:0 }}%</span>
                                            {% endif %}
                                        </strong>
                                    </td>
                                    <td>
                                        {% if attempt.score >= 70 %}
                                            <span class="badge bg-success">‚úÖ –û—Ç–ª–∏—á–Ω–æ</span>
                                        {% elif attempt.score >= 50 %}
                                            <span class="badge bg-warning text-dark">‚ö†Ô∏è –•–æ—Ä–æ—à–æ</span>
                                        {% else %}
                                            <span class="badge bg-danger">‚ùå –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å</span>
                                        {% endif %}
                                    </td>
                                    <td style="font-size: 0.9rem; color: #666;">{{ attempt.created|date:"d.m.y H:i" }}</td>
                                </tr>
                            {% endfor %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º -->
            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                        <th style="text-align: center;">–ü–æ–ø—ã—Ç–æ–∫</th>
                                        <th style="text-align: center;">–°—Ä–µ–¥–Ω–∏–π %</th>
                                        <th style="text-align: center;">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for data in subjects_data %}
                                        <tr>
                                            <td><strong>{{ data.subject.name }}</strong></td>
                                            <td style="text-align: center;">{{ data.count }}</td>
                                            <td style="text-align: center;">
                                                <span class="badge {% if data.average >= 70 %}bg-success{% elif data.average >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                                                    {{ data.average|floatformat:1 }}%
                                                </span>
                                            </td>
                                            <td style="text-align: center;">
                                                <strong>{{ data.max_score|floatformat:0 }}%</strong>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="alert alert-info" role="alert">
                <h5>üìã –ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                <p class="mb-0">–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç—ã –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–¥–µ—Å—å.</p>
            </div>
        {% endif %}
    {% endif %}
</div>

<style>
    .table-responsive {
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    
    .table thead th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }
    
    .table tbody tr:hover {
        background-color: #f5f5f5;
    }
</style>
{% endblock %}
